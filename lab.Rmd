---
title: "The Penguins Strike Back"
output: 
  html_notebook:
    toc: true
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    number_sections: true
    theme: cerule
---



# Setup

Because our lab uses a different data source than our lecture, I recommend clearing your global environment before running this setup chunk.

```{r setup, include=FALSE}
options(scipen = 999)
library(tidyverse)
penguins <- read_csv("data/penguins.csv")
```

## Data

**Description:** Size measurements for adult foraging penguins near Palmer
Station, Antarctica. Includes measurements for penguin species, island in Palmer
Archipelago, size (flipper length, body mass, bill dimensions), and sex.

**Format:** 

- A tibble with 344 rows and 8 variables:
- **species:** a factor denoting penguin species (AdÃ©lie, Chinstrap and Gentoo)
- **island:** a factor denoting island in Palmer Archipelago, Antarctica (Biscoe, Dream or Torgersen)
- **bill_length_mm:** a number denoting bill length (millimeters)
- **bill_depth_mm:** a number denoting bill depth (millimeters)
- **flipper_length_mm:** an integer denoting flipper length (millimeters)
- **body_mass_g:** an integer denoting body mass (grams)
- **sex:** a factor denoting penguin sex (female, male)
- **year:** an integer denoting the study year (2007, 2008, or 2009)

# Task 01

Question: Which species of penguin has the largest body mass and what is it?
Answer: 

Helpful Hint: Don't accept NA as an answer. Use `?mean` if you don't remember to handle missing values.

```{r}
## YOUR CODE HERE!

```

# Task 02

Question: Draw a distribution plot of flipper length and body mass. How would you describe the distribution of each? Upload your plots to Canvas to support your answer.
Answer: 

```{r}
## YOUR CODE HERE!

```

# Task 03

Question: In which year did they study the most penguins?
Answer:

Helpful Hint:
- Use dplyr verbs so you get an exact answer.

```{r}
## YOUR CODE HERE!

```

# Task 04

Question: In which year were the Adelie penguins the heaviest?
Answer: 

```{r}
## YOUR CODE HERE!

```

# Task 05

Question: Draw a bar plot of penguins studied every year. Be sure to include species and tell me which was the most frequently studied species in 2007.
Answer:

Helpful Hint:

- You can solve this geom_bar() OR geom_col().
- If your plots look stacked, try `position = "dodge"`. It makes life easier.
- Or you can use facet_wrap(). Your call really.

```{r}
## YOUR CODE HERE!

```


# Task 06

Question: Draw a plot showing the relationship between body mass (x) and flipper length (y). How would you describe this relationship? Upload your plot to Canvas. Extra credit (5) if you can add the regression line to your plot. Upload your plot to Canvas to support your answer.
Answer: 

Helpful Hint:

- Use geom_point here.

```{r}
## YOUR CODE HERE!

```

# Task 07

Question: Build a linear regression where flipper length (y) is explained as a function of body mass (x). What is the value of the intercept? What is the coefficient of body mass?
Answer: 

Helpful Hint: 
- In Canvas, round your answer to the hundredths. Thus, 1.0574 becomes 1.06.
- This is the formal regression of the plot from Task 04. So if your numbers are obviously wildly different, you did something wrong!!!!

```{r}
## YOUR CODE HERE!

```


# Task 08

Question: Using dplyr verbs, calculate the body mass of male penguins and female penguins. Which is larger? Calculate the standard deviation of body mass for each. Do you suspect the observed differences are statistically significant? Feel free to look at a plot of the body mass as well.
Answer: 

```{r}
## YOUR CODE HERE!

```

# Task 09

Question: Let's perform a t-test on our data. Please compare the averages here to what you calculated in Task 07. Was the p value less than .05?
Answer: 

```{r}
## Notice how this function is similar to lm.
## The data parameter is last.
t.test(body_mass_g ~ sex, penguins)
```

But, can you explain to me what the t-test is really doing?

# Task 10

Question: So, since most people cannot. Let's do a bootstrap. 
Answer: 

Helpful Hints:

- Traditional hypothesis testing procedures require equations to estimate sampling distributions using the properties of the sample data, the experimental design, and a test statistic. To obtain valid results, you'll need to use the proper test statistic and satisfy the assumptions.
- That's all kinda hard.
- We can use a bootstrap as a generic tool to do the same kinds of comparisons!
- So, what is a bootstrap? A bootstrap is a sample of our sample, sampled many times(with the same size, of course.)

To do this, we will introduce something called a loop!

```{r}
times <- 10
for (i in 1:times) {
    print(i)
}
```

We can use this to create a bootstrap sample of median weights. Run the code below. It will take a couple of seconds to run.

```{r}
times <- 1000
bs_samples <- tibble()
for (i in 1:times) {
    this_sample <- penguins %>% sample_n(size = nrow(penguins), replace = TRUE)
    bs_samples <- bind_rows(
        bs_samples,
        this_sample %>%
            group_by(sex) %>%
            summarize(avg_mass = mean(body_mass_g, na.rm = TRUE)) %>%
            pivot_wider(names_from = sex, values_from = avg_mass)
    )
}
```


Now let's look at what we have got.

```{r}
bs_samples
```

And we can plot what we have too:

```{r}
ggplot(bs_samples) +
    geom_density(aes(x = female), color = "deeppink") +
    geom_density(aes(x = male), color = "blue") +
    labs(title = "Male v Female Penguin Body Mass", x = "Body Mass (g)")
```

- The body mass of penguins is dependent on gender.
- But we can do a little bit more.

```{r}
avg_female <- mean(bs_samples$female)
sd_female <- sd(bs_samples$female)
low_female <- avg_female - 2 * sd_female
high_female <- avg_female + 2 * sd_female

avg_male <- mean(bs_samples$male)
sd_male <- sd(bs_samples$male)
low_male <- avg_male - 2 * sd_male
high_male <- avg_male + 2 * sd_male

ggplot(bs_samples) +
    geom_density(aes(x = female), color = "deeppink") +
    geom_vline(aes(xintercept = low_female), color = "deeppink") +
    geom_vline(aes(xintercept = high_female), color = "deeppink") +
    geom_density(aes(x = male), color = "blue") +
    geom_vline(aes(xintercept = low_male), color = "blue") +
    geom_vline(aes(xintercept = high_male), color = "blue") +
    labs(title = "Male v Female Penguin Body Mass", x = "Body Mass (g)")
```

So this tells us the same basic thing. It tells us that the 95% interval of these two distributions do not overlap. Which is, basically, the same thing the t-test told us.

But, and this is important. We can use the bootstrap to estimate and parameter. For example a coefficient in a regression model.

In Canvas, check off "Yes" that you've run this code and reviewed it.

The bootstrap is one of those things I get really excited about.